<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[ayapi.github.io]]></title><description><![CDATA[ぁゃぴがプログラミングのことをかくブログ]]></description><link>http://ayapi.github.io</link><generator>RSS for Node</generator><lastBuildDate>Wed, 27 Nov 2013 21:38:58 GMT</lastBuildDate><atom:link href="http://ayapi.github.io/feed.xml" rel="self" type="application/rss+xml"/><author><![CDATA[ぁゃぴ]]></author><pubDate>Wed, 27 Nov 2013 21:38:58 GMT</pubDate><copyright><![CDATA[2013 ぁゃぴ]]></copyright><language><![CDATA[en]]></language><managingEditor><![CDATA[ぁゃぴ]]></managingEditor><webMaster><![CDATA[ぁゃぴ]]></webMaster><ttl>60</ttl><item><title><![CDATA[ApacheCommonsMath3での標準偏差の算出]]></title><description><![CDATA[<p>Javaでゎ<a href="http://commons.apache.org/proper/commons-math/">ApacheCommonsMath</a>の<a href="http://commons.apache.org/proper/commons-math/userguide/stat.html">Stat</a>をっかぅと、<br>とてもかんたんに統計の計算ができます</p>
<p>標準偏差を求めるのゎ、たったこれだけでできます</p>
<p><code data-gist-id="7681028" data-gist-line="8-15" data-gist-file="Calculator.java"><a href="https://gist.github.com/ayapi/7681028#file-calculator-java">https://gist.github.com/ayapi/7681028#file-calculator-java</a> Line:8-15</code></p>
<p>けど、標準偏差を求める時に気をっけなきゃぃけなぃのが、その種類です<br>ひとことで標準偏差って言っても、<br>なんの標準偏差なのかってことがちがぅ時がぁります</p>
<p>ApacheCommonsMathの<code>SummaryStatistics</code>クラスに用意されてる<br>標準偏差を求める<code>getStandardDeviation()</code>メソッドゎ、<br>不偏標準偏差が返ります<br>\(\bar{x}\)を平均値としたとき</p>
<p>\begin{equation}<br>u = \sqrt{\sum_{i=1}^n \frac{(x_i - \bar{x})^2}{n - 1}}<br>\end{equation}</p>
<p>↑こっちのほーです(相当がんばってLaTeXかぃた結果ｗｗｗ)<br>Excelでゅーと<code>STDEV()</code>にぁたります</p>
<p>で、そーじゃなくて、母標準偏差、<br>\(\mu\)を平均値として</p>
<p>\begin{equation}<br>\sigma = \sqrt{\sum_{i=1}^N \frac{(x_i - \mu)^2}{N}}<br>\end{equation}</p>
<p>↑こっちのほー(まだがんばるｗｗｗｗ)<br>Excelでゅー<code>STDEVP()</code>なんですけど、<br>これを算出するメソッドゎ<code>SummaryStatistics</code>クラスにゎなぃです</p>
<p>けど、母分散を求めるメソッドゎぁるので、<br>それの平方根を取ればできます</p>
<p><code data-gist-id="7681028" data-gist-line="16-24" data-gist-file="Calculator.java"><a href="https://gist.github.com/ayapi/7681028#file-calculator-java">https://gist.github.com/ayapi/7681028#file-calculator-java</a> Line:16-24</code></p>
<p>なんで「Excelでゅーと」とか言ってるかってゅーと<br>Spockのテストデータっくるときに<br>Excelでゃればラクなんだってこと、ぃまさら気づぃたからです<br>今まで一生懸命、電卓でゃってました　まじばかすぎます<br>さすがにこーゅー計算ゎ電卓でゃるのたぃへんです</p>
<p><code data-gist-id="7681028" data-gist-file="CalculatorSpec.groovy"><a href="https://gist.github.com/ayapi/7681028#file-calculatorspec-groovy">https://gist.github.com/ayapi/7681028#file-calculatorspec-groovy</a></code></p>
]]></description><link>http://ayapi.github.io/posts/stdevapachecommonsmath/</link><guid isPermaLink="true">http://ayapi.github.io/posts/stdevapachecommonsmath/</guid><category><![CDATA[Java]]></category><dc:creator><![CDATA[ぁゃぴ]]></dc:creator><pubDate>Wed, 27 Nov 2013 21:00:00 GMT</pubDate></item><item><title><![CDATA[JXDatePickerで選択可能な日付範囲を制限する]]></title><description><![CDATA[<h2><a name="jxdatepickerにっぃて" class="anchor" href="#jxdatepickerにっぃて"><span class="header-link"></span></a>JXDatePickerにっぃて</h2>
<p>JXDatePickerゎSwingのコンポーネントで、<br>カレンダーから日付を選ぶUIをかんたんに追加できます<br>同様のものゎ名前まで似てる<a href="http://www.jdatepicker.com/">JDatePicker</a>とかぁるんですけど、<br>派生とかじゃなくてぜん②ちがぅものみたぃです</p>
<p>ただ選択させて、日付を取得するだけの<br>ぃちばんシンプルな使ぃ方だと、こんなかんじです</p>
<pre><code class="lang-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Calendar</span> <span class="kd">extends</span> <span class="n">JPanel</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">JXDatePicker</span> <span class="n">datePicker</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Calendar</span><span class="o">(){</span>
        <span class="n">datePicker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JXDatePicker</span><span class="o">();</span>
        <span class="n">add</span><span class="o">(</span><span class="n">datePicker</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getDate</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">datePicker</span><span class="o">.</span><span class="na">getDate</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</code></pre>
<h2><a name="選択可能な日付を制限する" class="anchor" href="#選択可能な日付を制限する"><span class="header-link"></span></a>選択可能な日付を制限する</h2>
<h3><a name="日付の計算と指定" class="anchor" href="#日付の計算と指定"><span class="header-link"></span></a>日付の計算と指定</h3>
<p>今回ゎ、明日以降の1週間だけを選択可能にしてみることにします</p>
<p>まず明日とか1週間後とかを計算しなきゃですが、<br><a href="http://commons.apache.org/proper/commons-lang/">Apache Commons Lang</a>の<code>DateUtils</code>クラスをっかぅと、<br>日付の計算もとてもかんたんにできます</p>
<p><code data-gist-id="7592669" data-gist-line="2" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"><a href="https://gist.github.com/ayapi/7592669">https://gist.github.com/ayapi/7592669</a> Line:2</code></p>
<p><code>DateUtils</code>クラスでの明日と1週間後の計算ゎこんなかんじでかんたんです</p>
<p><code data-gist-id="7592669" data-gist-line="15-16"><a href="https://gist.github.com/ayapi/7592669">https://gist.github.com/ayapi/7592669</a> Line:15-16</code></p>
<p>もし昨日とかがほしければ<code>addDays</code>で負の値を足せばできます</p>
<p>それで<code>JXDatePicker</code>のインスタンスに、<br>ぃっからぃっまで選択可能にするのかを指定します<br><code data-gist-id="7592669" data-gist-line="18-20"><a href="https://gist.github.com/ayapi/7592669">https://gist.github.com/ayapi/7592669</a> Line:18-20</code></p>
<h3><a name="みためを整ぇる" class="anchor" href="#みためを整ぇる"><span class="header-link"></span></a>みためを整ぇる</h3>
<p>以上のコードで動くにゎ動くんですけど、<br>デフォだと、バツ印が真っ赤で、ちょっと派手すぎって思ぅ時がぁります</p>
<p>バツ印の色を変ぇるにゎ<code>UIManager</code>のUIプロパティで色を指定します</p>
<p><code data-gist-id="7592669" data-gist-line="22"><a href="https://gist.github.com/ayapi/7592669">https://gist.github.com/ayapi/7592669</a> Line:22</code></p>
<p>このょーにUIプロパティーを変ぇた時ゎ、<br>値を変ぇたことをUIに適用(更新)するのが必要で、<br><code>JComponent</code>の<code>updateUI()</code>メソッドもしくゎ<br><code>SwingUtilities.updateComponentTreeUI()</code>どちらかをっかぃます</p>
<p>それで適用してみると、バツの色がちゃんと変ぇれました！</p>
<p><img src="/images/jxdatepicker_restriction_default_color.png" alt="JXDatePickerデフォルトカラー"> <img src="/images/jxdatepicker_restriction_custom_color.png" alt="JXDatePickerカスタムカラー"></p>
<h3><a name="syntheticaをぁててる時の注意" class="anchor" href="#syntheticaをぁててる時の注意"><span class="header-link"></span></a>Syntheticaをぁててる時の注意</h3>
<p>ちょっと話ずれるんですけど、<br>Swingのみためを一気にかっこょくしてくれる<br><a href="http://www.jyloo.com/synthetica/">Synthetica</a>ってゅーテーマ集がぁります<br>ぁゃぴも<a href="http://www.jyloo.com/synthetica/screenshots/blackeye/">BlackEye</a>を入れてテンションをぁげてます</p>
<p>けどSyntheticaをふつーに入れてるだけだと、<br>JXDatePickerがそも②動きません！<br>まったくぉなじエラーで困ってる人がぃました<br><a href="http://stackoverflow.com/questions/17467188/jxdatepicker-with-synthetica-aluoxide-look-and-feel-not-working">jxdatepicker with Synthetica Aluoxide look and feel not working - Stack Overflow</a></p>
<p>Syntheticaをっかってる状態でJXDatePickerを動かすにゎ<br><a href="http://www.jyloo.com/syntheticaaddons/">SyntheticaAddons</a>も入れれば動くょーになります</p>
<p>ちなむとSynthetica BlackEyeをぁてたらこんなかんじです<br>ゃっぱかっこぃぃ＼(^o^)／</p>
<p><img src="/images/jxdatepicker_with_blackeye.png" alt="JXDatePickerとSynthetica BlackEye"></p>
<h3><a name="完成ばん" class="anchor" href="#完成ばん"><span class="header-link"></span></a>完成ばん</h3>
<p>てことで、できたコードがこれですー＼(^o^)／</p>
<p><code data-gist-id="7592669"><a href="https://gist.github.com/ayapi/7592669">https://gist.github.com/ayapi/7592669</a></code></p>
]]></description><link>http://ayapi.github.io/posts/daterestrictiononjxdatepicker/</link><guid isPermaLink="true">http://ayapi.github.io/posts/daterestrictiononjxdatepicker/</guid><category><![CDATA[Java]]></category><category><![CDATA[Swing]]></category><dc:creator><![CDATA[ぁゃぴ]]></dc:creator><pubDate>Wed, 27 Nov 2013 11:34:00 GMT</pubDate></item><item><title><![CDATA[階調反転フィルターJava Swing/JLayer]]></title><description><![CDATA[<h2><a name="swingにっぃて" class="anchor" href="#swingにっぃて"><span class="header-link"></span></a>Swingにっぃて</h2>
<p>Swingゎ、JavaのGUIツールキットでとても有名なゃっです<br>JavaのGUIゎ、最近ゎJavaFX2とかもぁります<br>けど、ぁゃぴゎぃまメインでさゎってるSDKがSwingベースだから、<br>部分的にJavaFX2をっかってみたりしてゎぃるものの、<br>Swingの勉強もだぃぶ必要です</p>
<h2><a name="swingのjlayer" class="anchor" href="#swingのjlayer"><span class="header-link"></span></a>SwingのJLayer</h2>
<p>Swingにぉぃてゎ、JLayerクラス(JXLayerの派生)をっかって、<br>フィルターをっくることができ、<br>Oracle公式サイトに、とてもゎかりゃすぃ解説ページがぁります<br><a href="http://www.oracle.com/technetwork/jp/articles/java/jlayer-439461-ja.html">JLayerを使用したコンポーネントのデコレート方法 - Oracle</a><br>今回ゎこの解説にでてくるBlurエフェクトのサンプルを特に参考にします</p>
<p>ぁとRGB変換でゎ以下のサンプルが参考になります<br><a href="http://terai.xrea.jp/Swing/ColorChannelSwapFilter.html">JLayerを使ってJProgressBarの色相を変更する - Java Swing Tips - てんぷらメモ</a><br>↑ぃっぱぃSwingのサンプルが載ってて、すばらしぃです</p>
<h2><a name="jlayerで階調反転" class="anchor" href="#jlayerで階調反転"><span class="header-link"></span></a>JLayerで階調反転</h2>
<p>てゎけでさっそく、階調反転をSwingのJLayerでゃってみます</p>
<h3><a name="layeruiサブクラス" class="anchor" href="#layeruiサブクラス"><span class="header-link"></span></a>LayerUIサブクラス</h3>
<h4><a name="最小構成" class="anchor" href="#最小構成"><span class="header-link"></span></a>最小構成</h4>
<p>まず、<code>LayerUI</code>のサブクラスをかきます</p>
<blockquote>
<p><a href="http://www.oracle.com/technetwork/jp/articles/java/jlayer-439461-ja.html">JLayerを使用したコンポーネントのデコレート方法 - Oracle</a><br>LayerUIクラスのpaint()メソッドを使用すると、コンポーネントの描画方法を完全にコントロールできます。</p>
</blockquote>
<p>たとぇばまったくなにもぃじらなぃ<code>paint</code>メソッドゎこぅです</p>
<pre><code class="lang-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InvertColorLayerUI</span> <span class="kd">extends</span> <span class="n">LayerUI</span><span class="o">&lt;</span><span class="n">JComponent</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">paint</span><span class="o">(</span><span class="n">Graphics</span> <span class="n">g</span><span class="o">,</span> <span class="n">JComponent</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">paint</span><span class="o">(</span><span class="n">g</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</code></pre>
<h4><a name="オフスクリーンイメージの追加" class="anchor" href="#オフスクリーンイメージの追加"><span class="header-link"></span></a>オフスクリーンイメージの追加</h4>
<p>Oracle公式のBlurサンプルでも、てんぷらメモの色相サンプルでも、<br>オフスクリーンイメージがっかゎれてます<br>みぇなぃ画像に先にレンダリングしとぃて、ぁとから一気に表示する、<br>ってゃりかたで、これゎべっにJavaにゎ限らず、<br>グラフィック系でゎどこででもでてくるゃりかたです</p>
<p>まだフィルターゎなにもかけなぃで、<br>オフスクリーンイメージのしくみだけ追加するとこーなります</p>
<pre><code class="lang-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InvertColorLayerUI</span> <span class="kd">extends</span> <span class="n">LayerUI</span><span class="o">&lt;</span><span class="n">JComponent</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">BufferedImage</span> <span class="n">bufferedImage</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">paint</span><span class="o">(</span><span class="n">Graphics</span> <span class="n">g</span><span class="o">,</span> <span class="n">JComponent</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>

        <span class="c1">//オフスクリーンイメージがなかったり大きさがちがってたら生成する</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bufferedImage</span> <span class="o">==</span> <span class="kc">null</span>
                <span class="o">||</span> <span class="n">bufferedImage</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">!=</span> <span class="n">w</span>
                <span class="o">||</span> <span class="n">bufferedImage</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">!=</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bufferedImage</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="n">w</span><span class="o">,</span> <span class="n">h</span><span class="o">,</span> <span class="n">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_ARGB</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//オフスクリーンイメージにコンポーネントをレンダリングする</span>
        <span class="n">Graphics2D</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">bufferedImage</span><span class="o">.</span><span class="na">createGraphics</span><span class="o">();</span>
        <span class="n">g2</span><span class="o">.</span><span class="na">setClip</span><span class="o">(</span><span class="n">g</span><span class="o">.</span><span class="na">getClip</span><span class="o">());</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">paint</span><span class="o">(</span><span class="n">g2</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="n">g2</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>

        <span class="c1">//オフスクリーンイメージをそのまま画面に描画する</span>
        <span class="n">Image</span> <span class="n">image</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">createImage</span><span class="o">(</span><span class="n">bufferedImage</span><span class="o">.</span><span class="na">getSource</span><span class="o">());</span>
        <span class="n">g</span><span class="o">.</span><span class="na">drawImage</span><span class="o">(</span><span class="n">image</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</code></pre>
<h4><a name="フィルタークラスの追加" class="anchor" href="#フィルタークラスの追加"><span class="header-link"></span></a>フィルタークラスの追加</h4>
<p>それで、オフスクリーンイメージをそのまま画面に描画するんじゃなく、<br>オフスクリーンイメージに対してフィルターをかけるんですけど、<br>フィルターゎ<code>RGBImageFilter</code>を継承してっくるのがぃぃそぅです<br>ゃっとここで、階調反転そのものをかきます</p>
<p><code data-gist-id="7660869" data-gist-line="33-40"><a href="https://gist.github.com/ayapi/7660869">https://gist.github.com/ayapi/7660869</a> Line:33-40</code></p>
<p>このビット演算ゎ、Aゎ関係なぃので取り出してそのままの値で、<br>RGBゎ取り出して反転して、<br>AとRGBをまたぁゎせて返しましょぅ、とゅー内容です<br>このへんゎSwingだからって特別なとこゎなにもなぃです／(^o^)＼</p>
<h4><a name="paintメソッド内でフィルターを適用" class="anchor" href="#paintメソッド内でフィルターを適用"><span class="header-link"></span></a>paintメソッド内でフィルターを適用</h4>
<p>それで<code>LayerUI</code>サブクラスの<code>paint</code>メソッドの最後の描画の前で<br>このフィルタークラスを適用するょーにします</p>
<p><code data-gist-id="7660869" data-gist-line="25-30"><a href="https://gist.github.com/ayapi/7660869">https://gist.github.com/ayapi/7660869</a> Line:25-30</code></p>
<p>これで<code>LayerUI</code>サブクラスゎ完成です＼(^o^)／</p>
<h3><a name="jlayerにコンポーネントとlayeruiを指定する" class="anchor" href="#jlayerにコンポーネントとlayeruiを指定する"><span class="header-link"></span></a>JLayerにコンポーネントとLayerUIを指定する</h3>
<p>たとぇばパネルをソースにしてフィルターをかけるとすれば、<br>こーゅーふうに指定します<br>(実際にっかぅ時ゎ空のパネルじゃなくてぃろ②追加するんですけど)</p>
<p><code data-gist-id="7660869" data-gist-line="48-50"><a href="https://gist.github.com/ayapi/7660869">https://gist.github.com/ayapi/7660869</a> Line:48-50</code></p>
<p>そして<code>layer</code>だけを親のフレームとかに<code>add</code>します<br><code>panel</code>ゃ<code>layerUI</code>ゎもぅ<code>add</code>しなぃです</p>
<h3><a name="完成ばん" class="anchor" href="#完成ばん"><span class="header-link"></span></a>完成ばん</h3>
<p>とゅーゎけで、できたコードがこれですー！</p>
<p><code data-gist-id="7660869"><a href="https://gist.github.com/ayapi/7660869">https://gist.github.com/ayapi/7660869</a></code></p>
]]></description><link>http://ayapi.github.io/posts/colorinvertjlayer/</link><guid isPermaLink="true">http://ayapi.github.io/posts/colorinvertjlayer/</guid><category><![CDATA[Java]]></category><category><![CDATA[Swing]]></category><dc:creator><![CDATA[ぁゃぴ]]></dc:creator><pubDate>Tue, 26 Nov 2013 22:27:00 GMT</pubDate></item><item><title><![CDATA[階調反転フィルターCSS Microsoft編]]></title><description><![CDATA[<h2><a name="microsoft編… filter: dximagetransform" class="anchor" href="#microsoft編… filter: dximagetransform"><span class="header-link"></span></a>Microsoft編… filter: DXImageTransform</h2>
<p>CSSネタでゎまじだるぃIEなんですけど、<br>フィルター関係でゎDirectXをっかった独自実装の<br><code>filter: progid:DXImageTransform.Microsoft</code>が、ぁりました<br>「ぁりました」って過去形なのゎ、IE9の時点で非推奨とされ、<br>IE10からゎ完全に非対応となったからです</p>
<p>とりぁぇずIE10以降のことゎぉぃとぃて、<br><code>DXImageTransform</code>をっかった階調反転CSSを、<br>教科書どーりなかんじでかくと、以下のとーりです</p>
<pre><code class="lang-scss"><div class="highlight"><pre><span class="nc">.invert</span><span class="p">{</span>
  <span class="na">filter</span><span class="o">:</span> <span class="n">progid</span><span class="o">:</span><span class="n">DXImageTransform</span><span class="o">.</span><span class="n">Microsoft</span><span class="o">.</span><span class="nf">BasicImage</span><span class="p">(</span><span class="no">invert</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
  <span class="na">-ms-filter</span><span class="o">:</span> <span class="s2">&quot;progid:DXImageTransform.Microsoft.BasicImage(invert=1)&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>けど実ゎ、<code>invert</code>のみを適用する今回のょーな場合ゎ、<br>この長ぃ記述ゎまったく必要がなく、フィルター名だけで指定できます</p>
<pre><code class="lang-scss"><div class="highlight"><pre><span class="nc">.invert</span><span class="p">{</span>
  <span class="na">filter</span><span class="o">:</span> <span class="nf">invert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="na">-ms-filter</span><span class="o">:</span> <span class="nf">invert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>Webkitと同じかんじでかけるってことですね！<br>けどWebkitでゎパーセンテージ指定とかができますが<br>こっちでゎ0か1かしかだめなので気をっける必要がぁります</p>
<p>IETester v0.5.2をっかって、<br>IE7から9でこのCSSを適用したのが以下です</p>
<p><img src="/images/invert_old_ie.png" alt="IETester"></p>
<p>㊧から順番に、IE9、8、7です<br>7とかさすがにもぅ古すぎだし、ょくなぃ？<br>ってぁゃぴゎ思ってるんですけど、せっかく表示できたから載せます<br>非推奨となってるIE9でも、ちゃんと反転してます！</p>
<p>ただIE特有のブラウザモードとかドキュメントモードとか<br>ぁとWindows7なのか8なのか、とかでも<br>ちがってくるかもしれなぃです…</p>
<h2><a name="microsoft編… outline-color: invert" class="anchor" href="#microsoft編… outline-color: invert"><span class="header-link"></span></a>Microsoft編… outline-color: invert</h2>
<p>IE10-11でゎ、SVGフィルターゎぁるみたぃなんですけど、<br>Mozillaでできるょーな、<br>HTML要素にCSSからSVGフィルターを適用することゎ、できなぃみたぃです<br>ぁくまでSVGに対してしかSVGフィルターが適用できなぃです</p>
<p>じゃーなにSVGにすればぃーゎけ？って思ぅんですけど、<br>SVGの㊥でHTMLを扱ぅための<code>foreignObject</code>も非対応みたぃです</p>
<p>なのでfilterってゅー概念自体をぁきらめて、<br>かなりひどぃハックをゃらざるをぇません</p>
<p>かぃてみたんですけど、もぅまじむかっくんで、とりぁぇずみてくださぃ</p>
<pre><code class="lang-scss"><div class="highlight"><pre><span class="k">@media</span> <span class="nt">screen</span> <span class="nt">and</span> <span class="o">(</span><span class="nt">min-width</span><span class="nd">:0</span><span class="err">\</span><span class="nt">0</span><span class="o">)</span> <span class="p">{</span>
  <span class="na">_</span><span class="o">::-</span><span class="n">ms-reveal</span><span class="o">,</span>
  <span class="o">.</span><span class="no">invert</span><span class="o">:</span><span class="n">before</span><span class="p">{</span>
    <span class="na">content</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="na">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span> <span class="na">height</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="na">position</span><span class="o">:</span> <span class="no">absolute</span><span class="p">;</span>
    <span class="na">top</span><span class="o">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span> <span class="na">left</span><span class="o">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
    <span class="na">z-index</span><span class="o">:</span> <span class="mi">9999</span><span class="p">;</span>
    <span class="na">outline</span><span class="o">:</span> <span class="mi">2000</span><span class="kt">px</span> <span class="no">solid</span> <span class="no">invert</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="na">_</span><span class="o">::-</span><span class="n">ms-reveal</span><span class="o">,</span>
  <span class="o">.</span><span class="no">invert</span><span class="p">{</span>
    <span class="na">position</span><span class="o">:</span> <span class="no">relative</span><span class="p">;</span>
    <span class="na">overflow</span><span class="o">:</span> <span class="no">hidden</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>自分でかぃてぉきながらですが、なんなんでしょーかこれゎ<br>まず最初のメディアクエリー<code>@media screen and (min-width:0\0)</code>ゎ、<br>IE9以降だけに適用されるハックらしくて、<br>そして<code>_::-ms-reveal,</code>ゎ、<br>IE7とIE10以降とWebkitらへんで適用されるハックみたぃです<br>この2個を組み合ゎせて、<br>IEの10以降のみに適用されるょーになってるみたぃです</p>
<p>ブラウザハックにっぃてとても詳しぃ、<br>↓GitHubのこのリポジトリで載ってました<br><a href="https://github.com/4ae9b8/browserhacks/issues/39#issuecomment-27563945">4ae9b8/browserhacks #39 New hacks</a></p>
<p>で、実際に階調反転をしてるのゎ、<br>疑似要素に指定する<code>outline</code>プロパティです<br><code>outline</code>のカラーでしか、階調反転できるょーなものがなさげなんですね<br>それでゃたらと太くして、㊤に重ねてるってゎけです</p>
<p>この<code>outline</code>を使ぅってアイデア自体ゎ元々、<br>以下のページで提唱されたものです<br><a href="http://lea.verou.me/2011/04/invert-a-whole-webpage-with-css-only/">Invert a whole webpage with CSS only</a><br>けどこれゎ画面全体を階調反転するのを目的としたもので、<br>しかもChromeと干渉したりするから、<br>ぁゃぴがちょっと手を加ぇたってかんじです</p>
<p>それでWin8のIE10で適用したのが以下です</p>
<p><img src="/images/invert_newer_ie.png" alt="IE10"></p>
<p>borderに適用されなぃのゎ、まぁしょーがなぃかなってゅーか<br>もっとテンションぁがる系の手法がぁれば、ぉしぇてほしぃです</p>
]]></description><link>http://ayapi.github.io/posts/colorinvertcssonmicrosoft/</link><guid isPermaLink="true">http://ayapi.github.io/posts/colorinvertcssonmicrosoft/</guid><category><![CDATA[CSS]]></category><dc:creator><![CDATA[ぁゃぴ]]></dc:creator><pubDate>Mon, 25 Nov 2013 16:14:00 GMT</pubDate></item><item><title><![CDATA[階調反転フィルターCSS Mozilla編]]></title><description><![CDATA[<h2><a name="mozilla編… css3 filter: url(svg-url#element-id)" class="anchor" href="#mozilla編… css3 filter: url(svg-url#element-id)"><span class="header-link"></span></a>Mozilla編… CSS3 filter: url(svg-url#element-id)</h2>
<p>Firefoxにぉぃてゎ、<br>Webkit編でかぃた<code>filter: invert()</code>ゎ実装されてなく、<br>SVGでフィルターをっくってCSSに埋め込む必要がぁります<br>SVG自体にっぃてゎ、このページにとても詳しく載ってます<br><a href="http://www.h2.dion.ne.jp/~defghi/svgMemo/svgMemo_11.htm">svg要素の基本的な使い方まとめ</a><br>↑非常に貴重な情報で、とてもぁりがたぃです</p>
<h3><a name="ぃくっかぁる原始フィルターの書き方" class="anchor" href="#ぃくっかぁる原始フィルターの書き方"><span class="header-link"></span></a>ぃくっかぁる原始フィルターの書き方</h3>
<p>SVGで輝度を変換するにゎぃくっかの方法がぁるんですけど、<br>以下にかくサンプルゎどれもゃってることゎ同じ、階調反転です</p>
<h4><a name="fecolormatrixでmatrix" class="anchor" href="#fecolormatrixでmatrix"><span class="header-link"></span></a>feColorMatrixでmatrix</h4>
<p>仕様書にょると、<code>feColorMatrix type=&quot;matrix&quot;</code>にぉぃて、<br>適用される変換の行列ゎ以下のとーりです</p>
<p>\(<br>\left(<br>\begin{array}{c}<br>R&#39; \\<br>G&#39; \\<br>B&#39; \\<br>A&#39; \\<br>1  \\<br>\end{array}<br>\right)<br>=<br>\left(<br>\begin{array}{c}<br>a00 &amp; a01 &amp; a02 &amp; a03 &amp; a04 \\<br>a10 &amp; a11 &amp; a12 &amp; a13 &amp; a14 \\<br>a20 &amp; a21 &amp; a22 &amp; a23 &amp; a24 \\<br>a30 &amp; a31 &amp; a32 &amp; a33 &amp; a34 \\<br>  0 &amp;   0 &amp;   0 &amp;   0 &amp;   1 \\<br>\end{array}<br>\right)<br>\times<br>\left(<br>\begin{array}{c}<br>R \\<br>G \\<br>B \\<br>A \\<br>1  \\<br>\end{array}<br>\right)<br>\)</p>
<p>さらにゎかりゃすくするためにかくと、<br>a00～a34の値が以下のょーに与ぇられる時、<br>入力と出力がまったく同じ値になります</p>
<p>\(<br>\left|<br>\begin{array}{c}<br>1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\<br>0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\<br>0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\<br>0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\<br>\end{array}<br>\right|<br>\)</p>
<p>これに従ってRGBの輝度を反転させるなら、<br>フィルターゎ以下のょーになります<br>a00～a34の値を、スペースもしくゎカンマ区切りで<br><code>values</code>属性に指定して、変換を定義します<br>A(アルファ)ゎ関係なぃのでぃじりません</p>
<pre><code class="lang-xml"><div class="highlight"><pre><span class="nt">&lt;svg</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;filter</span> <span class="na">id=</span><span class="s">&quot;invert&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;feColorMatrix</span>
            <span class="na">in=</span><span class="s">&quot;SourceGraphic&quot;</span>
            <span class="na">type=</span><span class="s">&quot;matrix&quot;</span>
            <span class="na">values=</span><span class="s">&quot;-1, 0, 0, 0, 1,</span>
<span class="s">                     0,-1, 0, 0, 1,</span>
<span class="s">                     0, 0,-1, 0, 1,</span>
<span class="s">                     0, 0, 0, 1, 0&quot;</span>
         <span class="nt">/&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</pre></div>
</code></pre>
<h4><a name="fecomponenttransferでlinear" class="anchor" href="#fecomponenttransferでlinear"><span class="header-link"></span></a>feComponentTransferでlinear</h4>
<p>検索してると㊤の<code>matrix</code>での手法がょくかかれてるんですけど、<br>今回の階調反転のょーに、各チャンネルの出力に対して<br>ほかのチャンネルの入力が関係しなぃ<br>(たとぇばR&#39;の算出にGとBをっかゎなぃ)、<br>そーゅー変換でゎ、行列ょりか、<br><code>feComponentTransfer</code>のほうがゎかりゃすぃかもしれません<br><code>linear</code>ゎ一次関数で、<br><code>intercept</code>で切片、<code>slope</code>で傾きを指定します</p>
<pre><code class="lang-xml"><div class="highlight"><pre><span class="nt">&lt;svg</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;filter</span> <span class="na">id=</span><span class="s">&quot;invert&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;feComponentTransfer&gt;</span>
            <span class="nt">&lt;feFuncR</span> <span class="na">type=</span><span class="s">&quot;linear&quot;</span> <span class="na">slope=</span><span class="s">&quot;-1&quot;</span> <span class="na">intercept=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;feFuncG</span> <span class="na">type=</span><span class="s">&quot;linear&quot;</span> <span class="na">slope=</span><span class="s">&quot;-1&quot;</span> <span class="na">intercept=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;feFuncB</span> <span class="na">type=</span><span class="s">&quot;linear&quot;</span> <span class="na">slope=</span><span class="s">&quot;-1&quot;</span> <span class="na">intercept=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/feComponentTransfer&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</pre></div>
</code></pre>
<h4><a name="fecomponenttransferでtable" class="anchor" href="#fecomponenttransferでtable"><span class="header-link"></span></a>feComponentTransferでtable</h4>
<p><code>table</code>ゎ、折れ線を表現できるものですが、<br>与ぇる値を2個だけにすれば<code>linear</code>と同じ結果になります</p>
<pre><code class="lang-xml"><div class="highlight"><pre><span class="nt">&lt;svg</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;filter</span> <span class="na">id=</span><span class="s">&quot;invert&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;feComponentTransfer&gt;</span>
            <span class="nt">&lt;feFuncR</span> <span class="na">type=</span><span class="s">&quot;table&quot;</span> <span class="na">tableValues=</span><span class="s">&quot;1 0&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;feFuncG</span> <span class="na">type=</span><span class="s">&quot;table&quot;</span> <span class="na">tableValues=</span><span class="s">&quot;1 0&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;feFuncB</span> <span class="na">type=</span><span class="s">&quot;table&quot;</span> <span class="na">tableValues=</span><span class="s">&quot;1 0&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/feComponentTransfer&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</pre></div>
</code></pre>
<h3><a name="svgフィルタをcssで適用する" class="anchor" href="#svgフィルタをcssで適用する"><span class="header-link"></span></a>SVGフィルタをCSSで適用する</h3>
<p>変換自体ゎ以上のとーりで、どれかすきなのをっかぇばぃぃんですけど、<br>CSS3の<code>filter: url(svg-url#element-id)</code>をっかって、<br>DataURIスキームでSVGを埋め込むと、<br>HTMLの要素にフィルターを適用できます</p>
<p>以下ゎ、DataURIスキームなのでちょっと横に長くなっちゃぃますが、<br>㊤でっくったフィルターのぅち<code>feColorMatrix</code>をCSSにしたものです</p>
<pre><code class="lang-scss"><div class="highlight"><pre><span class="nc">.invert</span><span class="p">{</span>
  <span class="na">filter</span><span class="o">:</span> <span class="sx">url(&#39;data:image/svg+xml;utf8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;filter id=&quot;invert&quot;&gt;&lt;feColorMatrix in=&quot;SourceGraphic&quot; type=&quot;matrix&quot; values=&quot;-1,0,0,0,1,0,-1,0,0,1,0,0,-1,0,1,0,0,0,1,0&quot;/&gt;&lt;/filter&gt;&lt;/svg&gt;#invert&#39;)</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>Firefox 25で適用してみると、以下のょーになりました</p>
<p><img src="/images/invert_firefox.png" alt="Firefox 25での実行結果"></p>
<h3><a name="色空間のちがぃ" class="anchor" href="#色空間のちがぃ"><span class="header-link"></span></a>色空間のちがぃ</h3>
<p>たしかに反転できてるんですけど、<br>Webkitでの<code>filter: invert();</code>とゎ、だぃぶ出力がちがぃます</p>
<p><img src="/images/invert_diff_chrome_firefox.png" alt="FirefoxとChromeのfilterの出力のちがぃ"><br>㊧がFirefox、㊨がChromeです</p>
<p>これゎなぜかとゅーと、色空間がちがぅからです<br>SVGでの原始フィルターにゎどれにも共通で<br><code>color-interpolation-filters</code>とゅー属性がぁり、<br>この属性でフィルターで使ゎれる色空間が決められますが、<br>デフォルト値ゎ仕様でなぜか<code>linearRGB</code>になってます</p>
<p>これに<code>sRGB</code>を指定することで、自然な出力になり、<br>Webkitでの出力と同じにできます</p>
<pre><code class="lang-xml"><div class="highlight"><pre><span class="c">&lt;!-- feComponentTransferでsRGBを指定する例 --&gt;</span>
<span class="nt">&lt;svg</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;filter</span> <span class="na">id=</span><span class="s">&quot;invert&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;feComponentTransfer</span> <span class="na">color-interpolation-filters=</span><span class="s">&quot;sRGB&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;feFuncR</span> <span class="na">type=</span><span class="s">&quot;linear&quot;</span> <span class="na">slope=</span><span class="s">&quot;-1&quot;</span> <span class="na">intercept=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;feFuncG</span> <span class="na">type=</span><span class="s">&quot;linear&quot;</span> <span class="na">slope=</span><span class="s">&quot;-1&quot;</span> <span class="na">intercept=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;feFuncB</span> <span class="na">type=</span><span class="s">&quot;linear&quot;</span> <span class="na">slope=</span><span class="s">&quot;-1&quot;</span> <span class="na">intercept=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/feComponentTransfer&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</pre></div>
</code></pre>
<p>てことで、さっきの<code>feColorMatrix</code>のDataURIスキームのCSSに<br><code>color-interpolation-filters=&quot;sRGB&quot;</code>を追加してみます</p>
<pre><code class="lang-scss"><div class="highlight"><pre><span class="nc">.invert</span><span class="p">{</span>
  <span class="na">filter</span><span class="o">:</span> <span class="sx">url(&#39;data:image/svg+xml;utf8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;filter id=&quot;invert&quot;&gt;&lt;feColorMatrix color-interpolation-filters=&quot;sRGB&quot; in=&quot;SourceGraphic&quot; type=&quot;matrix&quot; values=&quot;-1,0,0,0,1,0,-1,0,0,1,0,0,-1,0,1,0,0,0,1,0&quot;/&gt;&lt;/filter&gt;&lt;/svg&gt;#invert&#39;)</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>これでふたたび適用してみると、意図したとーりの出力になりました！</p>
<p><img src="/images/invert_srgb.png" alt="Firefox 25での実行結果"></p>
]]></description><link>http://ayapi.github.io/posts/colorinvertcssonmozilla/</link><guid isPermaLink="true">http://ayapi.github.io/posts/colorinvertcssonmozilla/</guid><category><![CDATA[CSS]]></category><category><![CDATA[SVG]]></category><dc:creator><![CDATA[ぁゃぴ]]></dc:creator><pubDate>Mon, 25 Nov 2013 16:12:00 GMT</pubDate></item></channel></rss>